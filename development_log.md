# 開發日誌

## 2025-01-02: 數據加載失敗問題記錄

### 問題描述
在嘗試加載和處理數據時遇到嚴重問題，無法正確識別和加載任何動作類型的數據。具體表現為：

1. 無法識別任何動作類型（NoMovement 和 DrySwallow 樣本數均為 0）
2. 大量的 "無法確定文件的動作類型: original_lps.npy" 警告
3. 最終拋出 "沒有找到任何有效的數據文件" 的錯誤

### 失敗原因分析

1. **selection_types 映射問題**：
   ```python
   self.selection_types = {
       'NoMovement': ['無動作', '無吞嚥', '2024-10-22', '2024-10-24', '2024-10-14'],
       'DrySwallow': ['乾吞嚥1口', '乾吞嚥2口', '乾吞嚥3口', '乾吞嚥'],
       'WaterDrinking': ['吞水10ml', '吞水20ml', '喝水'],
       'Cracker': ['餅乾1塊', '餅乾2塊'],
       'Jelly': ['吞果凍']
   }
   ```
   - 嘗試使用日期作為 NoMovement 的識別關鍵字失敗
   - 關鍵字匹配可能過於嚴格，無法處理變體或不同格式

2. **info 文件讀取問題**：
   - 部分文件顯示 "Info文件中沒有selection字段"
   - JSON 文件中的字段可能帶有引號，導致無法正確匹配

3. **路徑處理邏輯問題**：
   - 在構建 info 文件路徑時可能存在錯誤
   - 目錄結構假設可能與實際不符

4. **數據過濾過於嚴格**：
   - 同時要求匹配動作類型和達到分數閾值
   - 所有樣本都被過濾掉，導致沒有任何有效數據

### 需要改進的方向

1. **數據讀取邏輯**：
   - 需要重新審視 info 文件的格式和讀取方式
   - 考慮處理帶引號的 JSON 字段

2. **動作類型識別**：
   - 放寬匹配條件，考慮部分匹配或模糊匹配
   - 重新設計 selection_types 映射

3. **路徑處理**：
   - 驗證並修正文件路徑構建邏輯
   - 添加更多的路徑存在性檢查

4. **錯誤處理**：
   - 改進錯誤日誌，提供更詳細的診斷信息
   - 添加數據完整性檢查

### 後續行動
需要徹底重構數據加載邏輯，特別是：
1. 重新設計動作類型識別機制
2. 改進 info 文件的讀取和解析
3. 添加更多的調試信息和數據驗證
4. 考慮添加數據預處理步驟 